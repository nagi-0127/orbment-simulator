(function(){"use strict";const A=(t,l,c)=>t.matrix[Math.imul(l,t.width)+c],V=(t,l,c,s)=>{t.matrix[Math.imul(l,t.width)+c]=s},H=t=>typeof t[Symbol.iterator]=="function"?t:Object.entries(t),z=t=>t===!0?!0:t===!1?new Set:t instanceof Set?t:new Set(t),Q=t=>{const{direction:l,objective:c,integers:s,binaries:v}=t,h=l==="minimize"?-1:1,w=H(t.constraints),r=H(t.variables),u=Array.isArray(r)?r:Array.from(r),g=[],m=[];if(s!=null||v!=null){const n=z(v),p=n===!0?!0:z(s);for(let f=1;f<=u.length;f++){const[d]=u[f-1];n===!0||n.has(d)?(g.push(f),m.push(f)):(p===!0||p.has(d))&&m.push(f)}}const a=new Map;for(const[n,p]of w){const f=a.get(n)??{row:NaN,lower:-1/0,upper:1/0};f.lower=Math.max(f.lower,p.equal??p.min??-1/0),f.upper=Math.min(f.upper,p.equal??p.max??1/0),a.has(n)||a.set(n,f)}let y=1;for(const n of a.values())n.row=y,y+=(Number.isFinite(n.lower)?1:0)+(Number.isFinite(n.upper)?1:0);const b=u.length+1,I=y+g.length,M=b+I,O=new Float64Array(b*I),e=new Int32Array(M),i=new Int32Array(M),o={matrix:O,width:b,height:I,positionOfVariable:e,variableAtPosition:i};for(let n=0;n<M;n++)e[n]=n,i[n]=n;for(let n=1;n<b;n++)for(const[p,f]of H(u[n-1][1])){p===c&&V(o,0,n,h*f);const d=a.get(p);d!=null&&(Number.isFinite(d.upper)?(V(o,d.row,n,f),Number.isFinite(d.lower)&&V(o,d.row+1,n,-f)):Number.isFinite(d.lower)&&V(o,d.row,n,-f))}for(const n of a.values())Number.isFinite(n.upper)?(V(o,n.row,0,n.upper),Number.isFinite(n.lower)&&V(o,n.row+1,0,-n.lower)):Number.isFinite(n.lower)&&V(o,n.row,0,-n.lower);for(let n=0;n<g.length;n++){const p=y+n;V(o,p,0,1),V(o,p,g[n],1)}return{tableau:o,sign:h,variables:u,integers:m}},B=(t,l)=>{const c=Math.round(1/l);return Math.round((t+Number.EPSILON)*c)/c},Z=(t,l,c)=>{const s=A(t,l,c),v=t.variableAtPosition[t.width+l],h=t.variableAtPosition[c];t.variableAtPosition[t.width+l]=h,t.variableAtPosition[c]=v,t.positionOfVariable[v]=c,t.positionOfVariable[h]=t.width+l;const w=[];for(let r=0;r<t.width;r++){const u=A(t,l,r);Math.abs(u)>1e-16?(V(t,l,r,u/s),w.push(r)):V(t,l,r,0)}V(t,l,c,1/s);for(let r=0;r<t.height;r++){if(r===l)continue;const u=A(t,r,c);if(Math.abs(u)>1e-16){for(let g=0;g<w.length;g++){const m=w[g];V(t,r,m,A(t,r,m)-u*A(t,l,m))}V(t,r,c,-u/s)}}},q=(t,l,c,s)=>{t.push([l.variableAtPosition[l.width+c],l.variableAtPosition[s]]);for(let v=6;v<=Math.trunc(t.length/2);v++){let h=!0;for(let w=0;w<v;w++){const r=t.length-1-w,[u,g]=t[r],[m,a]=t[r-v];if(u!==m||g!==a){h=!1;break}}if(h)return!0}return!1},W=(t,l)=>{const c=[],{precision:s,maxPivots:v,checkCycles:h}=l;for(let w=0;w<v;w++){let r=0,u=s;for(let a=1;a<t.width;a++){const y=A(t,0,a);y>u&&(u=y,r=a)}if(r===0)return["optimal",B(A(t,0,0),s)];let g=0,m=1/0;for(let a=1;a<t.height;a++){const y=A(t,a,r);if(y<=s)continue;const I=A(t,a,0)/y;if(I<m&&(g=a,m=I,I<=s))break}if(g===0)return["unbounded",r];if(h&&q(c,t,g,r))return["cycled",NaN];Z(t,g,r)}return["cycled",NaN]},G=(t,l)=>{const c=[],{precision:s,maxPivots:v,checkCycles:h}=l;for(let w=0;w<v;w++){let r=0,u=-s;for(let a=1;a<t.height;a++){const y=A(t,a,0);y<u&&(u=y,r=a)}if(r===0)return W(t,l);let g=0,m=-1/0;for(let a=1;a<t.width;a++){const y=A(t,r,a);if(y<-s){const b=-A(t,0,a)/y;b>m&&(m=b,g=a)}}if(g===0)return["infeasible",NaN];if(h&&q(c,t,r,g))return["cycled",NaN];Z(t,r,g)}return["cycled",NaN]};var X=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Y(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var R={exports:{}};(function(t,l){(function(){var c,s,v,h,w,r,u,g,m,a,y,b,I,M,O;v=Math.floor,a=Math.min,s=function(e,i){return e<i?-1:e>i?1:0},m=function(e,i,o,n,p){var f;if(o==null&&(o=0),p==null&&(p=s),o<0)throw new Error("lo must be non-negative");for(n==null&&(n=e.length);o<n;)f=v((o+n)/2),p(i,e[f])<0?n=f:o=f+1;return[].splice.apply(e,[o,o-o].concat(i)),i},r=function(e,i,o){return o==null&&(o=s),e.push(i),M(e,0,e.length-1,o)},w=function(e,i){var o,n;return i==null&&(i=s),o=e.pop(),e.length?(n=e[0],e[0]=o,O(e,0,i)):n=o,n},g=function(e,i,o){var n;return o==null&&(o=s),n=e[0],e[0]=i,O(e,0,o),n},u=function(e,i,o){var n;return o==null&&(o=s),e.length&&o(e[0],i)<0&&(n=[e[0],i],i=n[0],e[0]=n[1],O(e,0,o)),i},h=function(e,i){var o,n,p,f,d,N;for(i==null&&(i=s),f=(function(){N=[];for(var F=0,P=v(e.length/2);0<=P?F<P:F>P;0<=P?F++:F--)N.push(F);return N}).apply(this).reverse(),d=[],n=0,p=f.length;n<p;n++)o=f[n],d.push(O(e,o,i));return d},I=function(e,i,o){var n;if(o==null&&(o=s),n=e.indexOf(i),n!==-1)return M(e,0,n,o),O(e,n,o)},y=function(e,i,o){var n,p,f,d,N;if(o==null&&(o=s),p=e.slice(0,i),!p.length)return p;for(h(p,o),N=e.slice(i),f=0,d=N.length;f<d;f++)n=N[f],u(p,n,o);return p.sort(o).reverse()},b=function(e,i,o){var n,p,f,d,N,F,P,x,k;if(o==null&&(o=s),i*10<=e.length){if(f=e.slice(0,i).sort(o),!f.length)return f;for(p=f[f.length-1],P=e.slice(i),d=0,F=P.length;d<F;d++)n=P[d],o(n,p)<0&&(m(f,n,0,null,o),f.pop(),p=f[f.length-1]);return f}for(h(e,o),k=[],N=0,x=a(i,e.length);0<=x?N<x:N>x;0<=x?++N:--N)k.push(w(e,o));return k},M=function(e,i,o,n){var p,f,d;for(n==null&&(n=s),p=e[o];o>i;){if(d=o-1>>1,f=e[d],n(p,f)<0){e[o]=f,o=d;continue}break}return e[o]=p},O=function(e,i,o){var n,p,f,d,N;for(o==null&&(o=s),p=e.length,N=i,f=e[i],n=2*i+1;n<p;)d=n+1,d<p&&!(o(e[n],e[d])<0)&&(n=d),e[i]=e[n],i=n,n=2*i+1;return e[i]=f,M(e,N,i,o)},c=function(){e.push=r,e.pop=w,e.replace=g,e.pushpop=u,e.heapify=h,e.updateItem=I,e.nlargest=y,e.nsmallest=b;function e(i){this.cmp=i??s,this.nodes=[]}return e.prototype.push=function(i){return r(this.nodes,i,this.cmp)},e.prototype.pop=function(){return w(this.nodes,this.cmp)},e.prototype.peek=function(){return this.nodes[0]},e.prototype.contains=function(i){return this.nodes.indexOf(i)!==-1},e.prototype.replace=function(i){return g(this.nodes,i,this.cmp)},e.prototype.pushpop=function(i){return u(this.nodes,i,this.cmp)},e.prototype.heapify=function(){return h(this.nodes,this.cmp)},e.prototype.updateItem=function(i){return I(this.nodes,i,this.cmp)},e.prototype.clear=function(){return this.nodes=[]},e.prototype.empty=function(){return this.nodes.length===0},e.prototype.size=function(){return this.nodes.length},e.prototype.clone=function(){var i;return i=new e,i.nodes=this.nodes.slice(0),i},e.prototype.toArray=function(){return this.nodes.slice(0)},e.prototype.insert=e.prototype.push,e.prototype.top=e.prototype.peek,e.prototype.front=e.prototype.peek,e.prototype.has=e.prototype.contains,e.prototype.copy=e.prototype.clone,e}(),function(e,i){return t.exports=i()}(this,function(){return c})}).call(X)})(R);var tt=R.exports,et=tt,nt=Y(et);const U=(t,l)=>({matrix:new Float64Array(t),positionOfVariable:new Int32Array(l),variableAtPosition:new Int32Array(l)}),ot=(t,{matrix:l,positionOfVariable:c,variableAtPosition:s},v)=>{const{width:h,height:w}=t;l.set(t.matrix);for(let u=0;u<v.length;u++){const[g,m,a]=v[u],y=(w+u)*h,b=t.positionOfVariable[m];if(b<h)l[y]=g*a,l.fill(0,y+1,y+h),l[y+b]=g;else{const I=(b-h)*h;l[y]=g*(a-l[I]);for(let M=1;M<h;M++)l[y+M]=-g*l[I+M]}}c.set(t.positionOfVariable),s.set(t.variableAtPosition);const r=h+w+v.length;for(let u=h+w;u<r;u++)c[u]=u,s[u]=u;return{matrix:l.subarray(0,t.matrix.length+h*v.length),width:h,height:w+v.length,positionOfVariable:c.subarray(0,r),variableAtPosition:s.subarray(0,r)}},$=(t,l)=>{let c=0,s=0,v=0;for(let h=0;h<l.length;h++){const w=l[h],r=t.positionOfVariable[w]-t.width;if(r<0)continue;const u=A(t,r,0),g=Math.abs(u-Math.round(u));g>c&&(c=g,s=w,v=u)}return[s,v,c]},it=(t,l,c)=>{const{tableau:s,sign:v,integers:h}=t,{precision:w,maxIterations:r,tolerance:u,timeout:g}=c,[m,a,y]=$(s,h);if(y<=w)return[t,"optimal",l];const b=new nt((k,_)=>k[0]-_[0]);b.push([l,[[-1,m,Math.ceil(a)]]]),b.push([l,[[1,m,Math.floor(a)]]]);const I=h.length*2,M=s.matrix.length+I*s.width,O=s.positionOfVariable.length+I;let e=U(M,O),i=U(M,O);const o=l*(1-v*u),n=g+Date.now();let p=Date.now()>=n,f=!1,d=1/0,N=s,F=0;for(;F<r&&!b.empty()&&d>=o&&!p;){const[k,_]=b.pop();if(k>d)break;const D=ot(s,e,_),[ft,E]=G(D,c);if(ft==="optimal"&&E<d){const[L,K,ut]=$(D,h);if(ut<=w){f=!0,d=E,N=D;const C=i;i=e,e=C}else{const C=[],S=[];for(let j=0;j<_.length;j++){const T=_[j],[ct,ht]=T;ht===L?ct<0?S.push(T):C.push(T):(C.push(T),S.push(T))}S.push([1,L,Math.floor(K)]),C.push([-1,L,Math.ceil(K)]),b.push([E,C]),b.push([E,S])}}p=Date.now()>=n,F++}const x=(p||F>=r)&&!b.empty()&&d>=o?"timedout":f?"optimal":"infeasible";return[{...t,tableau:N},x,f?d:NaN]},J=({tableau:t,sign:l,variables:c},s,v,{precision:h,includeZeroVariables:w})=>{if(s==="optimal"||s==="timedout"&&!Number.isNaN(v)){const r=[];for(let u=0;u<c.length;u++){const[g]=c[u],m=t.positionOfVariable[u+1]-t.width,a=m>=0?A(t,m,0):0;a>h?r.push([g,B(a,h)]):w&&r.push([g,0])}return{status:s,result:-l*v,variables:r}}else if(s==="unbounded"){const r=t.variableAtPosition[v]-1;return{status:"unbounded",result:l*(1/0),variables:0<=r&&r<c.length?[[c[r][0],1/0]]:[]}}else return{status:s,result:NaN,variables:[]}},rt={precision:1e-8,checkCycles:!1,maxPivots:8192,tolerance:0,timeout:1/0,maxIterations:32768,includeZeroVariables:!1},st=(t,l)=>{const c=Q(t),s={...rt,...l},[v,h]=G(c.tableau,s);if(c.integers.length===0||v!=="optimal")return J(c,v,h,s);{const[w,r,u]=it(c,h,s);return J(w,r,u,s)}},lt=self;lt.onmessage=t=>{const l=st(t.data);self.postMessage(l)}})();
